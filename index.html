<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í•™êµ Q&A í”Œë«í¼</title>

<style>
body { font-family: Arial; background: #f4f6f8; margin: 0; padding: 0; }
.header { background: #2c3e50; color: white; padding: 15px; text-align:center; font-size:22px; }
.container { padding: 15px; }
input, textarea, select, button {
  width:100%; margin-top:8px; padding:10px; font-size:16px; border-radius:5px;
}
button { background:#2c3e50; color:white; border:none; cursor:pointer;}
button:hover { background:#1f2a38;}

.question-card { background:white; padding:12px; border-radius:8px; margin-top:10px;}
.answer { background:#fff; padding:8px; border-radius:6px; margin-top:6px;}
.report { background:#fff3cd; padding:8px; border-radius:6px; margin-top:6px;}
</style>
</head>
<body>

<div class="header">í•™êµ Q&A í”Œë«í¼</div>

<div class="container">

<div id="nicknameForm">
  <h3>ë‹‰ë„¤ì„ ì…ë ¥</h3>
  <input type="text" id="nickname" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ ì…ë ¥">
  <button onclick="setNickname()">í™•ì¸</button>
</div>

<div id="adminForm" style="margin-top:10px;">
  <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
  <input type="password" id="adminKey" placeholder="ê´€ë¦¬ì í‚¤">
  <button onclick="adminLogin()">ê´€ë¦¬ì ëª¨ë“œ ì§„ì…</button>
</div>

<div id="listView" style="display:none;">
  <h3>ì§ˆë¬¸ ëª©ë¡</h3>
  ê³¼ëª© í•„í„°:
  <select id="subjectFilter" onchange="loadQuestions()">
    <option value="">ì „ì²´</option>
    <option value="ìˆ˜í•™">ìˆ˜í•™</option>
    <option value="ì˜ì–´">ì˜ì–´</option>
    <option value="ê³¼í•™">ê³¼í•™</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
  </select>

  <div id="questions"></div>

  <hr>
  <h4>ìƒˆ ì§ˆë¬¸ ì‘ì„±</h4>
  <input type="text" id="newQuestionText" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">
  <select id="newSubject">
    <option value="ìˆ˜í•™">ìˆ˜í•™</option>
    <option value="ì˜ì–´">ì˜ì–´</option>
    <option value="ê³¼í•™">ê³¼í•™</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
  </select>
  <button onclick="addQuestion()">ì§ˆë¬¸ ë“±ë¡</button>
</div>

<div id="detailView" style="display:none;">
  <button onclick="goBack()">â¬…ï¸ ë’¤ë¡œ</button>
  <h3 id="detailSubject"></h3>
  <p id="detailText"></p>
  <p><strong>ì‘ì„±ì:</strong> <span id="detailNickname"></span></p>

  <h4>ğŸ—¨ ë‹µë³€ë“¤</h4>
  <div id="answers"></div>

  <h4>ë‹µë³€ ì‘ì„±</h4>
  <textarea id="newAnswerText" rows="3" placeholder="ë‹µë³€ ì…ë ¥"></textarea>
  <button onclick="addAnswer()">ë‹µë³€ ì „ì†¡</button>

  <h4 style="margin-top:20px;">ğŸ“› ì‹ ê³ í•˜ê¸°</h4>
  <input type="text" id="reportReason" placeholder="ì‹ ê³  ì‚¬ìœ  ì…ë ¥">
  <button onclick="reportItem()">ì‹ ê³ í•˜ê¸°</button>
  <div id="reportThanks"></div>
</div>

<div id="adminView" style="display:none; margin-top:20px;">
  <h3>ğŸ“Œ ì‹ ê³ ëœ ë‚´ìš©</h3>
  <div id="reportsList"></div>
  <button onclick="hideAdmin()">ê´€ë¦¬ì ë‚˜ê°€ê¸°</button>
</div>

</div>


<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC9y33YK_3b5NMfAk6dZi2jDMIi_dDXklQ",
  authDomain: "site4school-6affe.firebaseapp.com",
  projectId: "site4school-6affe",
  storageBucket: "site4school-6affe.firebasestorage.app",
  messagingSenderId: "527337035288",
  appId: "1:527337035288:web:290da151584a31eb90d56d",
  measurementId: "G-PLB6VXX955"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentNickname = "";
let currentQuestionId = "";
let isAdmin = false;
const ADMIN_KEY = "AdminSecret2026!";

function setNickname() {
  const nick = document.getElementById("nickname").value.trim();
  if (!nick) return alert("ë‹‰ë„¤ì„ ì…ë ¥í•´!");
  currentNickname = nick;
  document.getElementById("nicknameForm").style.display="none";
  document.getElementById("listView").style.display="block";
  loadQuestions();
}

function adminLogin() {
  const key = document.getElementById("adminKey").value.trim();
  if (key===ADMIN_KEY) {
    isAdmin=true;
    alert("ê´€ë¦¬ì ëª¨ë“œ!");
    document.getElementById("adminView").style.display="block";
    loadReports();
  } else alert("í‚¤ í‹€ë¦¼!");
}

async function addQuestion() {
  const text = document.getElementById("newQuestionText").value.trim();
  const subject = document.getElementById("newSubject").value;
  if (!text) return;
  await db.collection("questions").add({
    nickname: currentNickname,
    text, subject, createdAt: Date.now()
  });
  document.getElementById("newQuestionText").value="";
  loadQuestions();
}

async function loadQuestions() {
  const sel = document.getElementById("subjectFilter").value;
  let qCol = db.collection("questions");
  if (sel) qCol = qCol.where("subject","==",sel);
  const snapshot = await qCol.get();
  const cont = document.getElementById("questions");
  cont.innerHTML="";
  snapshot.forEach(doc => {
    const q = doc.data();
    const div = document.createElement("div");
    div.className="question-card";
    let html = `<strong>${q.subject}</strong> â€” ${q.text}<br><small>${q.nickname}</small>`;
    if (isAdmin) html+= `<br><button onclick="deleteQuestion('${doc.id}')">âŒ ì§ˆë¬¸ ì‚­ì œ</button>`;
    div.innerHTML=html;
    div.onclick = ()=> showDetail(doc.id,q);
    cont.appendChild(div);
  });
}

function goBack() {
  document.getElementById("detailView").style.display="none";
  document.getElementById("listView").style.display="block";
}

function showDetail(id,data) {
  currentQuestionId=id;
  document.getElementById("listView").style.display="none";
  document.getElementById("detailView").style.display="block";
  document.getElementById("detailSubject").innerText=data.subject;
  document.getElementById("detailText").innerText=data.text;
  document.getElementById("detailNickname").innerText=data.nickname;
  loadAnswers();
}

async function addAnswer() {
  const text=document.getElementById("newAnswerText").value.trim();
  if (!text) return;
  await db.collection("questions").doc(currentQuestionId).collection("answers").add({
    nickname: currentNickname, text, createdAt:Date.now()
  });
  document.getElementById("newAnswerText").value="";
  loadAnswers();
}

async function loadAnswers() {
  const ansDiv=document.getElementById("answers");
  ansDiv.innerHTML="";
  const snap=await db.collection("questions").doc(currentQuestionId).collection("answers").get();
  snap.forEach(doc=>{
    const a=doc.data();
    const div=document.createElement("div");
    div.className="answer";
    let html=`<strong>${a.nickname}:</strong> ${a.text}`;
    if(isAdmin) html+= ` <button onclick="deleteAnswer('${currentQuestionId}','${doc.id}')">âŒ</button>`;
    div.innerHTML=html; ansDiv.appendChild(div);
  });
}

async function reportItem() {
  const reason=document.getElementById("reportReason").value.trim();
  if (!reason) return alert("ì‹ ê³  ì‚¬ìœ  ì…ë ¥!");
  await db.collection("reports").add({targetId:currentQuestionId, reason, createdAt:Date.now()});
  document.getElementById("reportThanks").innerText="ğŸ“© ì‹ ê³ ë¨!";
}

async function loadReports() {
  const list=document.getElementById("reportsList");
  list.innerHTML="";
  const snap=await db.collection("reports").get();
  snap.forEach(doc=>{
    const r=doc.data();
    const div=document.createElement("div");
    div.className="report";
    div.innerHTML=`â— ì§ˆë¬¸ ID: ${r.targetId}<br>ì‚¬ìœ : ${r.reason}<br>
    <button onclick="deleteReport('${doc.id}')">âœ” ì²˜ë¦¬</button>`;
    list.appendChild(div);
  });
}

async function deleteQuestion(id) { await db.collection("questions").doc(id).delete(); loadQuestions(); }
async function deleteAnswer(qId,aId) { await db.collection("questions").doc(qId).collection("answers").doc(aId).delete(); loadAnswers(); }
async function deleteReport(id) { await db.collection("reports").doc(id).delete(); loadReports(); }
</script>
