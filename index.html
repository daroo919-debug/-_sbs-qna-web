<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í•™êµ Q&A í”Œë«í¼</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}
.header {
  background: #2c3e50;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 22px;
}
.container {
  padding: 15px;
}
input, textarea, select, button {
  width: 100%;
  margin-top: 8px;
  padding: 10px;
  font-size: 16px;
  border-radius: 5px;
}
button {
  background: #2c3e50;
  color: white;
  border: none;
  cursor: pointer;
}
.question-card {
  background: white;
  padding: 12px;
  border-radius: 8px;
  margin-top: 10px;
}
.answer {
  background: #fff;
  padding: 8px;
  border-radius: 6px;
  margin-top: 6px;
}
</style>
</head>
<body>

<div class="header">í•™êµ Q&A í”Œë«í¼</div>

<div class="container" id="main">

  <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
  <div id="nicknameForm">
    <h3>ë‹‰ë„¤ì„ ì…ë ¥</h3>
    <input type="text" id="nickname" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ ì…ë ¥">
    <button onclick="setNickname()">í™•ì¸</button>
  </div>

  <!-- ì§ˆë¬¸ ëª©ë¡ -->
  <div id="listView" style="display:none;">
    <h3>ì§ˆë¬¸ ëª©ë¡</h3>
    <select id="subjectFilter">
      <option value="">ì „ì²´</option>
      <option value="ìˆ˜í•™">ìˆ˜í•™</option>
      <option value="ì˜ì–´">ì˜ì–´</option>
      <option value="ê³¼í•™">ê³¼í•™</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    </select>
    <div id="questions"></div>
    <hr>
    ì§ˆë¬¸ ì œëª©:
    <input type="text" id="newQuestionText">
    ê³¼ëª© ì„ íƒ:
    <select id="newSubject">
      <option value="ìˆ˜í•™">ìˆ˜í•™</option>
      <option value="ì˜ì–´">ì˜ì–´</option>
      <option value="ê³¼í•™">ê³¼í•™</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    </select>
    <button onclick="addQuestion()">ì§ˆë¬¸ ë“±ë¡</button>
  </div>

  <!-- ì§ˆë¬¸ ìƒì„¸ -->
  <div id="detailView" style="display:none;">
    <button onclick="goBack()">â¬…ï¸ ë’¤ë¡œ</button>
    <h3 id="detailSubject"></h3>
    <p id="detailText"></p>
    <p><strong>ì‘ì„±ì:</strong> <span id="detailNickname"></span></p>

    <h4>ğŸ—¨ ë‹µë³€ë“¤</h4>
    <div id="answers"></div>

    ë‹µë³€ ì…ë ¥:
    <textarea id="newAnswerText" rows="3"></textarea>
    <button onclick="addAnswer()">ë‹µë³€ ì „ì†¡</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC9y33YK_3b5NMfAk6dZi2jDMIi_dDXklQ",
  authDomain: "site4school-6affe.firebaseapp.com",
  projectId: "site4school-6affe",
  storageBucket: "site4school-6affe.firebasestorage.app",
  messagingSenderId: "527337035288",
  appId: "1:527337035288:web:290da151584a31eb90d56d",
  measurementId: "G-PLB6VXX955"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentNickname = "";
let currentQuestionId = "";

function setNickname() {
  const nick = document.getElementById("nickname").value.trim();
  if (!nick) {
    alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }
  currentNickname = nick;
  document.getElementById("nicknameForm").style.display = "none";
  document.getElementById("listView").style.display = "block";
  loadQuestions();
}

async function addQuestion() {
  const text = document.getElementById("newQuestionText").value.trim();
  const subject = document.getElementById("newSubject").value;
  if (!text) return;

  await addDoc(collection(db, "questions"), {
    nickname: currentNickname,
    text: text,
    subject: subject,
    createdAt: Date.now()
  });

  document.getElementById("newQuestionText").value = "";
  loadQuestions();
}

async function loadQuestions() {
  const sel = document.getElementById("subjectFilter").value;
  let qRef = collection(db, "questions");
  if (sel) qRef = query(qRef, where("subject", "==", sel));
  const snapshot = await getDocs(qRef);

  const container = document.getElementById("questions");
  container.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement("div");
    div.className = "question-card";
    div.innerHTML = `
      <strong>${data.subject}</strong> â€” ${data.text}<br>
      <small>ì‘ì„±ì: ${data.nickname}</small>
    `;
    div.onclick = () => showDetail(doc.id, data);
    container.appendChild(div);
  });
}

function showDetail(id, data) {
  currentQuestionId = id;
  document.getElementById("listView").style.display = "none";
  document.getElementById("detailView").style.display = "block";
  document.getElementById("detailSubject").innerText = `${data.subject}`;
  document.getElementById("detailText").innerText = `${data.text}`;
  document.getElementById("detailNickname").innerText = `${data.nickname}`;
  loadAnswers();
}

function goBack() {
  document.getElementById("detailView").style.display = "none";
  document.getElementById("listView").style.display = "block";
}

async function loadAnswers() {
  const ansDiv = document.getElementById("answers");
  ansDiv.innerHTML = "";
  const ansSnapshot = await getDocs(collection(db, "questions", currentQuestionId, "answers"));
  ansSnapshot.forEach(doc => {
    const ans = doc.data();
    const div = document.createElement("div");
    div.className = "answer";
    div.innerHTML = `<strong>${ans.nickname}:</strong> ${ans.text}`;
    ansDiv.appendChild(div);
  });
}

async function addAnswer() {
  const text = document.getElementById("newAnswerText").value.trim();
  if (!text) return;
  await addDoc(collection(db, "questions", currentQuestionId, "answers"), {
    nickname: currentNickname,
    text: text,
    createdAt: Date.now()
  });
  document.getElementById("newAnswerText").value = "";
  loadAnswers();
}
</script>

</body>
</html>
